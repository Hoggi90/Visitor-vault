<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Results</title>
    <link rel="stylesheet" href="./assets/style.css" />

    <!-- Leaflet CSS -->
    <link rel="stylesheet" href="https://unpkg.com/leaflet@1.7.1/dist/leaflet.css" />

    <style>
        #map {
            width: 100%;
            height: 600px;
        }
    </style>
</head>

<body>
    <header>
        <nav class="navbar">
            <ul class="nav-items">
                <li><a href="index.html">Home</a></li>
                <li><a href="about-us.html">About Us</a></li>
                <li><a href="results.html">The Vault</a></li>
                <li><a href="contact.html">Contact Us</a></li>
                <li><a href="index.html">Log in</a></li>
            </ul>
        </nav>
    </header>

    <div class="Vault">
        <h2>Visitor Vault - The Vault</h2>
        <p>See where other visitors have left their mark!</p>
        <ul id="visitorsList">
            <!-- Visitor data will be inserted here -->
        </ul>
    </div>

    <!-- Map container -->
    <div id="map"></div> <!-- Added map container -->

    <script src="./assets/results.js"></script>

    <!-- Leaflet JS -->
    <script src="https://unpkg.com/leaflet@1.7.1/dist/leaflet.js"></script>

<script>
    // Initialize Leaflet Map
    const map = L.map('map').setView([51.505, -0.09], 2); // Set initial coordinates and zoom level

    // Set the OpenStreetMap tile layer
    L.tileLayer('https://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png', {
        attribution: '&copy; <a href="https://www.openstreetmap.org/copyright">OpenStreetMap</a> contributors'
    }).addTo(map);

    // Fetch and plot the visitors' locations
    async function plotVisitors() {
        try {
            // Fetch visitor data from your API
            const response = await fetch('https://h9v6coissi.execute-api.eu-west-2.amazonaws.com/fetch-visitors');
            const data = await response.json();

            if (data.visitors) {
                data.visitors.forEach(async (visitor) => {
                    const location = visitor.location;
                    const name = visitor.name;

                    if (location) {
                        // Use Nominatim to geocode the location
                        const geoResponse = await fetch(`https://nominatim.openstreetmap.org/search?format=json&q=${encodeURIComponent(location)}&addressdetails=1&limit=1`);
                        const geoData = await geoResponse.json();

                        if (geoData.length > 0) {
                            const lat = parseFloat(geoData[0].lat);
                            const lon = parseFloat(geoData[0].lon);

                            // Add a marker for the visitor's location
                            L.marker([lat, lon])
                                .addTo(map)
                                .bindPopup(`<b>${name}</b><br>${location}`);
                        } else {
                            console.warn(`Geocoding failed for location: ${location}`);
                        }
                    }
                });
            } else {
                console.log("No visitors data available.");
            }
        } catch (error) {
            console.error("Error fetching visitors data:", error);
        }
    }

    // Call the function to plot visitors on the map
    plotVisitors();
</script>


</body>

</html>